#!/usr/bin/env node
import { BattleNode } from './index.js';
import * as readline from 'readline';
const args = process.argv.slice(2);
if (args.length < 3) {
    console.log('Usage: battle-rcon <ip> <port> <password>');
    console.log('Example: battle-rcon 127.0.0.1 2302 mypassword');
    process.exit(1);
}
const ip = args[0] ?? '127.0.0.1';
const portStr = args[1] ?? '2302';
const password = args[2] ?? '';
const config = {
    ip,
    port: parseInt(portStr, 10),
    rconPassword: password,
    transportType: 'udp',
    logLevel: 'info',
    logger: (level, message) => {
        if (level === 'error' || level === 'warn') {
            const timestamp = new Date().toISOString();
            console.log(`[${timestamp}] [${level.toUpperCase()}] ${message}`);
        }
        else if (level === 'info') {
            console.log(message);
        }
    }
};
const client = new BattleNode(config);
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    prompt: 'RCON> '
});
console.log('--- DayZ BattlEye RCON CLI (v2.1 TypeScript Strict) ---');
client.login()
    .then(() => {
    console.log('Connected and Logged In!');
    console.log('Type commands below. Type "exit" to quit.');
    rl.prompt();
})
    .catch((err) => {
    if (err instanceof Error) {
        console.error('Login Failed:', err.message);
    }
    else {
        console.error('Login Failed:', String(err));
    }
    process.exit(1);
});
client.on('message', (msg) => {
    const messageStr = Buffer.isBuffer(msg) ? msg.toString('utf8') : String(msg);
    process.stdout.clearLine(0);
    process.stdout.cursorTo(0);
    console.log(`[SERVER]: ${messageStr}`);
    rl.prompt(true);
});
client.on('disconnected', () => {
    console.log('\nDisconnected from server.');
    process.exit(0);
});
client.on('error', (err) => {
    console.error(`\nSocket Error: ${err.message}`);
});
rl.on('line', async (line) => {
    const command = line.trim();
    if (command === 'exit' || command === 'quit') {
        process.exit(0);
    }
    if (command === '') {
        rl.prompt();
        return;
    }
    try {
        const response = await client.sendCommand(command);
        console.log(response);
    }
    catch (err) {
        if (err instanceof Error) {
            console.error(`Error: ${err.message}`);
        }
        else {
            console.error(`Error: ${String(err)}`);
        }
    }
    rl.prompt();
});
rl.on('close', () => {
    process.exit(0);
});
//# sourceMappingURL=cli.js.map